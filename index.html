<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amalgamation Tower Defence</title>
    <link rel="stylesheet" href="game/style.css">
</head>
<body>

    <div id="app-layout">
        <!-- Header -->
        <div id="header-panel">
            <div class="stat-box"><span class="stat-icon currency">Ψ</span><span id="money-display">300</span></div>
            <div class="stat-box"><span class="stat-icon lives">♥</span><span id="lives-display">100</span></div>
            <div class="stat-box"><span class="stat-icon wave">WAVE</span><span id="wave-display">1</span></div>
        </div>

        <!-- Left Sidebar (Abilities) -->
        <div id="left-panel">
            <div class="panel-label">Abilities</div>
            <button id="ability-laser" class="ability-btn" onclick="activateAbility('laser')">
                <span>ORBITAL LASER</span>
                <span class="key-hint">[Z]</span>
                <div id="cd-laser" class="cooldown-overlay"></div>
            </button>
            <button id="ability-freeze" class="ability-btn" onclick="activateAbility('freeze')">
                <span>TIME FREEZE</span>
                <span class="key-hint">[X]</span>
                <div id="cd-freeze" class="cooldown-overlay"></div>
            </button>
        </div>

        <!-- Game Area -->
        <div id="game-area">
            <canvas id="gameCanvas" width="1000" height="600"></canvas>
            
            <!-- Floating Upgrade Modal (Centered over canvas) -->
            <div id="upgrade-modal">
                <div class="upgrade-header">
                    <div>
                        <span id="selected-tower-name">Tower Name</span>
                        <span id="dps-display">Dmg: 0</span>
                        <button id="priority-btn" onclick="cyclePriority()">Target: First</button>
                    </div>
                    <button class="upgrade-btn" style="width: auto; padding: 2px 8px;" onclick="closeUpgradeMenu()">X</button>
                </div>
                <div class="upgrade-paths">
                    <div class="path-column path-tech">
                        <span class="path-key-hint">[Q]</span>
                        <div class="path-title">Science / Tech</div>
                        <div id="path-1-desc" style="font-size: 11px; height: 30px; margin-bottom: 5px;">Upgrade Desc</div>
                        <button id="btn-upgrade-1" class="upgrade-btn" onclick="buyUpgrade(1)">Upgrade (Ψ <span id="cost-1">0</span>)</button>
                    </div>
                    <div class="path-column path-magic">
                        <span class="path-key-hint">[E]</span>
                        <div class="path-title">Arcane / Magic</div>
                        <div id="path-2-desc" style="font-size: 11px; height: 30px; margin-bottom: 5px;">Upgrade Desc</div>
                        <button id="btn-upgrade-2" class="upgrade-btn" onclick="buyUpgrade(2)">Upgrade (Ψ <span id="cost-2">0</span>)</button>
                    </div>
                </div>
                <button class="upgrade-btn sell-btn" onclick="sellSelectedTower()">Sell Tower (Ψ <span id="sell-value">0</span>)</button>
            </div>
        </div>

        <!-- Right Sidebar (Constructs / Shop) -->
        <div id="right-panel">
            <div class="panel-label">Constructs</div>
            <div id="shop-list">
                <div id="card-miner" class="tower-card" onclick="selectTowerToBuild('miner', this)">
                    <span class="hotkey-hint">1</span>
                    <div class="tower-name">Data-Mine</div><div class="tower-cost">Ψ 150</div><div class="tower-desc">Passive Income.</div>
                </div>
                <div id="card-sentry" class="tower-card" onclick="selectTowerToBuild('sentry', this)">
                    <span class="hotkey-hint">2</span>
                    <div class="tower-name">Quantum Sentry</div><div class="tower-cost">Ψ 250</div><div class="tower-desc">Rapid Kinetic Fire.</div>
                </div>
                 <div id="card-vent" class="tower-card" onclick="selectTowerToBuild('vent', this)">
                    <span class="hotkey-hint">3</span>
                    <div class="tower-name">Flux Vent</div><div class="tower-cost">Ψ 300</div><div class="tower-desc">Short Range AoE.</div>
                </div>
                <div id="card-pylon" class="tower-card" onclick="selectTowerToBuild('pylon', this)">
                    <span class="hotkey-hint">4</span>
                    <div class="tower-name">Chrono-Pylon</div><div class="tower-cost">Ψ 350</div><div class="tower-desc">Buffs Towers.</div>
                </div>
                <div id="card-prism" class="tower-card" onclick="selectTowerToBuild('prism', this)">
                    <span class="hotkey-hint">5</span>
                    <div class="tower-name">Aether Prism</div><div class="tower-cost">Ψ 400</div><div class="tower-desc">Energy Beam.</div>
                </div>
                 <div id="card-coil" class="tower-card" onclick="selectTowerToBuild('coil', this)">
                    <span class="hotkey-hint">6</span>
                    <div class="tower-name">Tesla Coil</div><div class="tower-cost">Ψ 450</div><div class="tower-desc">Chain Lightning.</div>
                </div>
                <div id="card-lance" class="tower-card" onclick="selectTowerToBuild('lance', this)">
                    <span class="hotkey-hint">7</span>
                    <div class="tower-name">Void Lance</div><div class="tower-cost">Ψ 500</div><div class="tower-desc">Sniper.</div>
                </div>
                <div id="card-fabricator" class="tower-card" onclick="selectTowerToBuild('fabricator', this)">
                    <span class="hotkey-hint">8</span>
                    <div class="tower-name">Fabricator</div><div class="tower-cost">Ψ 550</div><div class="tower-desc">Places Mines.</div>
                </div>
                <div id="card-mortar" class="tower-card" onclick="selectTowerToBuild('mortar', this)">
                    <span class="hotkey-hint">9</span>
                    <div class="tower-name">Gravity Mortar</div><div class="tower-cost">Ψ 600</div><div class="tower-desc">Long Range Splash.</div>
                </div>
                <div id="card-nullifier" class="tower-card" onclick="selectTowerToBuild('nullifier', this)">
                    <span class="hotkey-hint">0</span>
                    <div class="tower-name">Nullifier</div><div class="tower-cost">Ψ 700</div><div class="tower-desc">Strips Resistances.</div>
                </div>
            </div>
        </div>

        <!-- Footer (Controls) -->
        <div id="footer-panel">
            <button id="start-wave-btn" class="control-btn" onclick="startNextWave()">START WAVE</button>
            <button id="auto-btn" class="control-btn" onclick="toggleAutoStart()">Auto: OFF</button>
            <button id="speed-btn" class="control-btn" onclick="toggleSpeed()">Speed: 1x</button>
        </div>

        <!-- Overlays -->
        <div id="map-screen">
            <h1>AMALGAMATION CAMPAIGN</h1>
            <div class="map-grid" id="map-grid-container"></div>
        </div>

        <div id="level-complete">
            <h1 style="color: var(--gold);">SECTOR SECURED</h1>
            <p style="font-size: 24px; color: #fff;">All hostiles neutralized.</p>
            <div class="modal-buttons">
                <button class="control-btn" onclick="returnToMenu()">Menu</button>
                <button class="control-btn" style="border-color: var(--gold); color: var(--gold);" onclick="continueEndless()">Endless Mode</button>
            </div>
        </div>

        <div id="game-over">
            <h1 style="color: #ff4444;">SYSTEM FAILURE</h1>
            <p style="font-size: 24px; color: #fff;">The core has been breached.</p>
            <div class="modal-buttons">
                <button class="control-btn" onclick="location.reload()">Reboot System</button>
            </div>
        </div>

    </div>
    <!--<script type="module" src="game/script.js"></script>-->
    <script src="game/script.js"></script>
</body>
</html>